<div class="main_section h-100 d-flex flex-column gap-3" *ngIf="!pageLoader">
    <div class="header d-flex align-items-center">
        <div class="header_section h-100 w-100 d-flex align-items-center justify-content-between">
            <div class="left-side">
            <div class="count_section">
                {{cycleWorkitems?.length}} Work Items
            </div>
        </div>
        <!-- <div class="text">All Work Items </div> -->
        <div class="right-side d-flex align-items-center gap-3">
            <div class="search-container">
                <!-- <div class="search_icon">
              <img src="https://d2yx15pncgmu63.cloudfront.net/prod-images/619530c1751455755108search.png" alt="">
            </div> -->
                <input type="text" placeholder="Search Work Items" class="search-input with-icon"
                  [(ngModel)]="searchText" (input)="onSearchChange()" />
              </div>
            <div class="filter_section d-flex align-items-center gap-2">
                <div (click)="refreshWorkItems()" class="refresh_btn common-icon">
                <img src="https://d2yx15pncgmu63.cloudfront.net/prod-images/509042c1751455690898fi_13432623.png" alt="">
              </div>
              <div (click)="openFilterMenu()" class="filter_btn common-icon">
                <img src="https://d2yx15pncgmu63.cloudfront.net/prod-images/542223c1751455713485fi_2676824.png" alt="">
              </div>
            </div>
            <div class="create-btn" *ngIf="cycleWorkitems?.length !== 0">
            <button class="add-view-button custom-btn-postion" (click)="createWorkItem()">
                Create Work Item
            </button>
        </div>
        </div> 
        </div>
    </div>
    <div class="inside-content h-100" *ngIf="cycleWorkitems && cycleWorkitems.length > 0 ; else emptyscreen">
        <div class="workitems h-100">
        <!-- <ng-container *ngFor="let state of states"> -->
            <ng-container *ngFor="let item of cycleWorkitems">
                <div class="issue_card d-flex align-items-center justify-content-between" (click)="detailWorkitem(item)">
                    <div class="left_side d-flex align-items-center gap-1">
                        <div class="issue_no">{{item.displayBugNo}}</div>
                        <div class="issue_desc">{{item.title | slice:0:40 }}{{ item?.title?.length > 40 ? '...' : '' }}</div>
                    </div>
                    <div class="right_side d-flex align-items-center gap-2">
                        <div class="issue_state common-style d-flex align-items-center gap-1">
                            <img [src]="getIconForState(item?.state?.name)" width="16" height="16"
                    alt="{{ item?.state?.name || 'No State' }}" /><span>{{item?.state?.name}}</span>
                        </div>
                        <div class="priority common-style d-flex align-items-center gap-1">
                        <img [src]="getIconForPriority(item?.priority)" width="16" height="16"
                    alt="{{ item?.priority || 'None' }}" /><span class="priority-text">{{item?.priority}}</span>
                        </div>
                        <div class="start-date common-style d-flex align-items-center gap-1">
                            <img class="icon" src="https://d2z9497xp8xb12.cloudfront.net/prod-images/600095c1752832352947calender.jpg" alt="" width="16" height="16">
                            <span class="date-text">{{item?.startDate | date: 'dd/MM/yyyy'}}</span>
                        </div>
                        <div class="end-date common-style d-flex align-items-center gap-1">
                            <img class="icon" src="https://d2z9497xp8xb12.cloudfront.net/prod-images/600095c1752832352947calender.jpg" alt="" width="16" height="16">
                            <span class="date-text">{{item?.endDate | date: 'dd/MM/yyyy'}}</span>
                        </div>
                        <div class="assignee">
                                <ng-container *ngIf="item?.assignee?.length === 1">
                                    <div class="assignee-single d-flex align-items-center justify-content-center">
                                    <div class="avatar">{{ getInitial(item.assignee[0]?.name) }}</div>
                                    <!-- <span class="assignee-name">{{ item.assignee[0]?.name }}</span> -->
                                    </div>
                                </ng-container>

                                <ng-container *ngIf="item?.assignee?.length > 1">
                                    <div class="assignee-multiple d-flex align-items-center justify-content-center">
                                    <div class="multi_avatar" *ngFor="let user of item.assignee">
                                        {{ getInitial(user?.name) }}
                                    </div>
                                    </div>
                                </ng-container>
                            </div>
                        <div class="module common-style d-flex align-items-center gap-1">
                            <svg viewBox="0 0 24 24" class="h-3 w-3 flex-shrink-0 stroke-2" stroke="currentColor" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M19 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19V5C21 3.89543 20.1046 3 19 3Z" stroke-linecap="round" stroke-linejoin="round"></path><path d="M8.77778 7H7.22222C7.09949 7 7 7.09949 7 7.22222V8.77778C7 8.90051 7.09949 9 7.22222 9H8.77778C8.90051 9 9 8.90051 9 8.77778V7.22222C9 7.09949 8.90051 7 8.77778 7Z" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"></path><path d="M8.77778 15H7.22222C7.09949 15 7 15.0995 7 15.2222V16.7778C7 16.9005 7.09949 17 7.22222 17H8.77778C8.90051 17 9 16.9005 9 16.7778V15.2222C9 15.0995 8.90051 15 8.77778 15Z" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"></path><path d="M16.7778 7H15.2222C15.0995 7 15 7.09949 15 7.22222V8.77778C15 8.90051 15.0995 9 15.2222 9H16.7778C16.9005 9 17 8.90051 17 8.77778V7.22222C17 7.09949 16.9005 7 16.7778 7Z" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"></path><path d="M16.7778 15H15.2222C15.0995 15 15 15.0995 15 15.2222V16.7778C15 16.9005 15.0995 17 15.2222 17H16.7778C16.9005 17 17 16.9005 17 16.7778V15.2222C17 15.0995 16.9005 15 16.7778 15Z" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                            <span class="module-text">{{item.modules?.name}}</span>
                        </div>
                        <div class="cycle common-style d-flex align-items-center gap-1">
                            <div class="img"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 12 12"
                      fill="none">
                      <circle cx="6" cy="6" r="5.65" stroke="#000D4D" stroke-opacity="0.45" stroke-width="0.7" />
                      <path
                        d="M6 10C7.06087 10 8.07828 9.57857 8.82843 8.82843C9.57857 8.07828 10 7.06087 10 6C10 4.93913 9.57857 3.92172 8.82843 3.17157C8.07828 2.42143 7.06087 2 6 2L6 6L6 10Z"
                        fill="#000D4D" fill-opacity="0.45" />
                    </svg></div>
                            <span class="cycle-text">{{item.cycle?.name}}</span>
                        </div>
                        <div class="issue_label common-style d-flex align-items-center gap-1"
                        [title]="item?.label?.name || 'Label'">
                            <div class="dot"></div>
                            <div class="label">{{item?.label?.name || 'No Label'}}</div>
                        </div>
                    </div>
                </div>
            </ng-container>
        <!-- </ng-container> -->
    </div>
    </div>
      <ng-template #emptyscreen>

    <div *ngIf="cycleWorkitems?.length == 0" class="empty d-flex flex-column align-items-center h-100 justify-content-center gap-3">
        <div class="text d-flex justify-content-center"><h4>Work item doesn't exist</h4></div>
        <!-- <div class="text d-flex justify-content-center">Once a project is added, all the work items related to the project will be visible here.</div> -->
        <!-- <div class="img-section d-flex justify-content-center">
          <img class="w-100" src="https://d2z9497xp8xb12.cloudfront.net/prod-images/368091c1752445143187ChatGPT Image Jul 14, 2025, 03_48_48 AM.png" alt="">
        </div> -->
        <button class="add-view-button custom-btn-postion" (click)="createWorkItem()">
                Create Work Item
        </button>

    </div>
</ng-template>
</div>
<section class="loader_section" *ngIf="pageLoader">
    <div class="api_loader">
        <app-anime-loader></app-anime-loader>
    </div>
</section>