<div class="create-module-container">
  <h2 class="title">{{ data?.edit ? 'Edit module' : 'Create module' }}</h2>

  <div class="user-tag">
    <span class="icon">ðŸ“¦</span>
    <span class="text">{{data?.data?.projectName}}</span>
  </div>

  <form [formGroup]="moduleForm" (ngSubmit)="onSubmit()">
    <div class="form-group">
      <input type="text" 
             class="form-control" 
             placeholder="Title"
             formControlName="title">
    </div>

    <div class="form-group">
      <textarea class="form-control description" 
                placeholder="Click to add description"
                formControlName="description"></textarea>
    </div>

    <div class="actions-row w-100">
      <button type="button" class="action-btn" (click)="picker.open()">
        <span class="icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days flex-shrink-0 w-100 h-100">
            <path d="M8 2v4"></path>
            <path d="M16 2v4"></path>
            <rect width="18" height="18" x="3" y="4" rx="2"></rect>
            <path d="M3 10h18"></path>
          </svg>
        </span>
        <span class="date-text">
          <span>{{getDateRangeText()}}</span>
          <span class="remove-btn" *ngIf="startDate && endDate" (click)="clearDateRange($event)">âœ•</span>
        </span>
      </button>

      <button type="button" 
              class="action-btn" 
              [class.active]="moduleForm.get('backlog')?.value && selectedBacklogState"
              (click)="toggleBacklog($event)">
        <span class="icon">
          <svg height="12px" width="12px" class="flex-shrink-0 h-100 w-100 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 323.15 323.03">
            <g id="Layer_2" data-name="Layer 2">
              <g id="Layer_1-2" data-name="Layer 1">
                <path fill="#A3A3A3" d="M163.42,322.92A172.12,172.12,0,0,1,104.8,312.7c-3.92-1.4-5.22-3.05-3.07-7.1,2.4-4.52,3-11.38,6.64-13.48s9.34,2.47,14.23,3.81c29.55,8.11,58.78,7.25,87.57-3.31,4.08-1.5,5.86-1.05,7.09,3.21a82.63,82.63,0,0,0,4.6,11c1.19,2.57,1,4.06-2,5.2a163.84,163.84,0,0,1-40.05,9.76C173.84,322.45,167.89,323.34,163.42,322.92Z"></path>
                <path fill="#A3A3A3" d="M.07,163a174.76,174.76,0,0,1,10.07-58c1.59-4.57,3.53-5.59,7.8-3.2a61,61,0,0,0,10.11,4.19c3.11,1.06,4.07,2.46,2.71,5.79-6.43,15.73-9.17,32.33-9.23,49.14a132.65,132.65,0,0,0,8.17,47.35c2.44,6.5,2.33,6.57-4.06,9.35-3.35,1.45-6.83,2.63-10.11,4.23-2.44,1.19-3.54.49-4.43-1.86a162.3,162.3,0,0,1-10-41C.51,173.12-.24,167.17.07,163Z"></path>
                <path fill="#A3A3A3" d="M323,160.16a169.68,169.68,0,0,1-10.2,58.09c-1.45,4.08-3.21,5.07-7.14,3a105.3,105.3,0,0,0-11.48-4.81c-2.23-.85-3.2-1.85-2.16-4.41a133.86,133.86,0,0,0,9.57-48.59,132,132,0,0,0-8.9-50.69c-1.67-4.24-.8-5.79,3.29-7a84,84,0,0,0,11-4.62c2.65-1.24,4.05-.82,5.16,2.12a159.68,159.68,0,0,1,9.68,39C322.56,148.71,323.52,155.17,323,160.16Z"></path>
                <path fill="#A3A3A3" d="M161.59,0a164.28,164.28,0,0,1,58,10.72c2.81,1,3.75,2,2.41,4.93-2,4.38-3.86,8.84-5.5,13.37-.93,2.56-2.28,2.77-4.53,1.87a137.94,137.94,0,0,0-99.35-.52c-3.43,1.32-5.3,1.35-6.45-2.69a50.33,50.33,0,0,0-4.55-11c-2.25-3.93-.36-5.11,2.9-6.29A165.32,165.32,0,0,1,161.59,0Z"></path>
              </g>
            </g>
          </svg>
        </span>
        <span class="status-text">
          <span>{{getBacklogStateText()}}</span>
          <span class="remove-btn" *ngIf="moduleForm.get('backlog')?.value && selectedBacklogState" (click)="toggleBacklog(); $event.stopPropagation()">âœ•</span>
        </span>
      </button>

      <button type="button" class="action-btn" (click)="selectLead($event)">
        <span class="icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user flex-shrink-0 w-100 h-100">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </span>
        <span class="lead-text">
          <span>{{getLeadText()}}</span>
          <span class="remove-btn" *ngIf="selectedLead" (click)="selectedLead = null; $event.stopPropagation()">âœ•</span>
        </span>
      </button>

      <button type="button" class="action-btn members-action-btn" (click)="selectMembers($event)">
        
        <span class="members-text" *ngIf="selectedMembers.length === 0">
          <span class="icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users mx-[4px] flex-shrink-0 w-100 h-100">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
        </span>
          <span>Members</span>
        </span>
        <div class="selected-members-inline" *ngIf="selectedMembers.length > 0">
          <div class="member-avatars">
            <div *ngFor="let member of selectedMembers; let i = index" 
                 class="member-avatar-inline" 
                 [style.z-index]="selectedMembers.length - i"
                 [style.background-color]="getAvatarColor(i)">
              <span class="member-initials-inline">{{getInitials(member?.name)}}</span>
            </div>
          </div>
        </div>
        <span class="remove-btn" *ngIf="selectedMembers.length > 0" (click)="clearAllMembers(); $event.stopPropagation()">âœ•</span>
      </button>
    </div>

    <!-- <div class="selected-members-detail" *ngIf="selectedMembers.length > 0">
      <div class="members-header mb-2">
        <span class="members-title">Selected Members ({{selectedMembers.length}})</span>
        <button type="button" class="clear-all-btn" (click)="clearAllMembers()">Clear All</button>
      </div>
      <div class="members-list d-flex flex-wrap gap-2 mb-3">
        <div *ngFor="let member of selectedMembers; let i = index" class="member-card">
          <div class="member-avatar" [style.background-color]="getAvatarColor(i)">
            <span class="member-initials">{{getInitials(member.name)}}</span>
          </div>
          <div class="member-info">
            <span class="member-name">{{member.name}}</span>
            <span class="member-role" *ngIf="member.role">{{member.role}}</span>
          </div>
          <button class="remove-member-btn" (click)="removeMember(member)">
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 6L6 18"></path>
              <path d="M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>
    </div> -->

    <div class="footer d-flex justify-content-end align-items-center gap-4">
      <div class="right">
        <button type="button" class="btn btn-secondary" (click)="onCancel()" [disabled]="isLoading">Discard</button>
        <button type="submit" class="btn save-btn" [disabled]="!moduleForm.valid || isLoading" (click)="createModule()">
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
          <span class="custom-btn" *ngIf="isLoading">Loading...</span>
          <span class="custom-btn" *ngIf="!isLoading">Save</span>
        </button>
      </div>
    </div>
  </form>

  <!-- Hidden date picker -->
  <mat-form-field appearance="outline" style="visibility: hidden; position: absolute; top: -1000px;">
    <mat-date-range-input [rangePicker]="picker">
      <input matStartDate placeholder="Start date" [(ngModel)]="startDate" (ngModelChange)="changeData()">
      <input matEndDate placeholder="End date" [(ngModel)]="endDate" (ngModelChange)="changeData()">
    </mat-date-range-input>
    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
    <mat-date-range-picker #picker></mat-date-range-picker>
  </mat-form-field>
</div>
